(async function init(){ try{ listarSolicitudesAbiertas(); }catch(e){} })();
async function listarSolicitudesAbiertas(){ const cont=document.getElementById('solicitudes_abiertas'); cont.innerHTML='Cargando...'; try{ const list=await apiSolicitudesAbiertas(); cont.innerHTML=''; list.forEach(pr=>{ const div=document.createElement('div'); div.className='item'; const inputId=`offer_price_${pr._id}`; div.innerHTML=`<div class="flex"><strong>${pr.productName}</strong> x ${pr.quantity}<span class="badge">${pr.status}</span></div><div class="small">${pr.details||''}</div><div class="actions"><input type="number" id="${inputId}" placeholder="Precio oferta"/><button onclick="ofertar('${pr._id}','${inputId}')">Ofertar</button></div>`; cont.appendChild(div); }); }catch(e){ cont.innerHTML=`<div class="error">${e.message}</div>`; } }
async function ofertar(requestId,inputId){ const price=document.getElementById(inputId).value; if(!price) return alert('Ingrese precio'); try{ const of=await apiCrearOferta(requestId, Number(price)); alert(`Oferta creada: ${of._id}`); }catch(e){ alert(e.message); } }
async function contraofertaProveedor(){ const id=document.getElementById('prov_offer_id').value.trim(); const price=Number(document.getElementById('prov_price').value); const msg=document.getElementById('prov_msg'); try{ if(!id||!price) throw new Error('ID y precio son requeridos'); const r=await apiContraofertaProveedor(id, price); msg.textContent=r.message; msg.className='small success'; }catch(e){ msg.textContent=e.message; msg.className='small error'; } }
